meta {
  name: Test Authentication
  type: http
  seq: 3
}

post {
  url: {{api_base}}/scrape
  body: json
  auth: none
}

headers {
  Content-Type: application/json
  Accept: application/json
  X-API-Key: {{api_key}}
}

body:json {
  {
    "url": "https://httpbin.org/html",
    "options": {
      "wait_time": 1,
      "screenshot": false,
      "extract_text": true,
      "timeout": 15
    },
    "metadata": {
      "test": "authentication_check"
    }
  }
}

tests {
  test("Status should be 202", function() {
    expect(res.getStatus()).to.equal(202);
  });
  
  test("Should return job_id", function() {
    const body = res.getBody();
    expect(body).to.have.property('job_id');
    expect(body.job_id).to.be.a('string');
  });
  
  test("Should return status pending", function() {
    const body = res.getBody();
    expect(body).to.have.property('status');
    expect(body.status).to.equal('pending');
  });
  
  test("Should return created_at timestamp", function() {
    const body = res.getBody();
    expect(body).to.have.property('created_at');
  });
  
  test("Authentication successful", function() {
    console.log("âœ… API Key authentication working correctly");
  });
}

docs {
  # Test Authentication

  Test successful API authentication by sending a request with a valid API key.

  ## Use Case
  
  Verify that API key authentication is working correctly and accepts valid keys.

  ## Expected Behavior
  
  - Returns 202 (Accepted) when valid API key is provided
  - Creates a new scraping job successfully
  - Returns job details including job_id and status
  
  ## Authentication
  
  This request includes the X-API-Key header to test successful authentication.
  Uses the {{api_key}} variable from the Production environment.
  
  ## Response
  
  ```json
  {
    "job_id": "123e4567-e89b-12d3-a456-426614174000",
    "status": "pending",
    "url": "https://httpbin.org/html",
    "created_at": "2025-10-19T23:24:51.413971+00:00",
    "estimated_completion": "2025-10-19T23:25:21.424525",
    "priority": 0
  }
  ```
}